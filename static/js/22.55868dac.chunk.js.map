{"version":3,"sources":["styles/ImageCropper.module.css","components/ImageCropper.js","containers/ProfileMaker.js"],"names":["module","exports","ImageCropper","props","useState","upImg","setUpImg","imgRef","useRef","previewCanvasRef","unit","width","aspect","crop","setCrop","completedCrop","setCompletedCrop","useEffect","current","image","canvas","scaleX","naturalWidth","scaleY","naturalHeight","height","ctx","getContext","setTransform","imageSmoothingEnabled","drawImage","x","y","generateDownload","previewCanvas","newWidth","newHeight","tmpCanvas","document","createElement","getResizedCanvas","toBlob","blob","storageRef","firebase","storage","ref","child","name","put","then","snapshot","getDownloadURL","url","submit","onLoad","useCallback","img","className","styles","wrapper","type","accept","onChange","event","target","files","length","reader","FileReader","addEventListener","result","readAsDataURL","src","onImageLoaded","c","onComplete","preview","style","onClick","ProfileMaker","redirect","setRedirect","setName","toggle","setToggle","title","useParams","db","firestore","history","useHistory","submitHandler","path","data","JSON","parse","sessionStorage","getItem","console","log","collection","doc","update","members","role","push","catch","err","alert","message","to","imageUploader","flex","Input","value","onChangeText","PrimaryButton"],"mappings":"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","file":"static/js/22.55868dac.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"ImageCropper_wrapper__2Hb3o\",\"preview\":\"ImageCropper_preview__3e-GM\"};","import React, { useState, useRef, useCallback, useEffect } from \"react\";\nimport ReactCrop from \"react-image-crop\";\nimport styles from \"../styles/ImageCropper.module.css\";\nimport \"react-image-crop/dist/ReactCrop.css\";\nimport firebase from \"../helpers/firebase\";\n\nconst pixelRatio = 4;\nconst ImageCropper = (props) => {\n  const [upImg, setUpImg] = useState();\n  const imgRef = useRef(null);\n  const previewCanvasRef = useRef(null);\n  const [crop, setCrop] = useState({ unit: \"px\", width: 100, aspect: 1 });\n  const [completedCrop, setCompletedCrop] = useState(null);\n\n  useEffect(() => {\n    if (!completedCrop || !previewCanvasRef.current || !imgRef.current) {\n      return;\n    }\n\n    const image = imgRef.current;\n    const canvas = previewCanvasRef.current;\n    const crop = completedCrop;\n\n    const scaleX = image.naturalWidth / image.width;\n    const scaleY = image.naturalHeight / image.height;\n    const ctx = canvas.getContext(\"2d\");\n\n    canvas.width = crop.width * pixelRatio;\n    canvas.height = crop.height * pixelRatio;\n\n    ctx.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\n    ctx.imageSmoothingEnabled = false;\n\n    ctx.drawImage(\n      image,\n      crop.x * scaleX,\n      crop.y * scaleY,\n      crop.width * scaleX,\n      crop.height * scaleY,\n      0,\n      0,\n      crop.width,\n      crop.height\n    );\n  }, [completedCrop]);\n\n  const onSelectFile = (event) => {\n    if (event.target.files && event.target.files.length > 0) {\n      const reader = new FileReader();\n      reader.addEventListener(\"load\", () => setUpImg(reader.result));\n      reader.readAsDataURL(event.target.files[0]);\n    }\n  };\n  const getResizedCanvas = (canvas, newWidth, newHeight) => {\n    const tmpCanvas = document.createElement(\"canvas\");\n    tmpCanvas.width = newWidth;\n    tmpCanvas.height = newHeight;\n\n    const ctx = tmpCanvas.getContext(\"2d\");\n    ctx.drawImage(\n      canvas,\n      0,\n      0,\n      canvas.width,\n      canvas.height,\n      0,\n      0,\n      newWidth,\n      newHeight\n    );\n\n    return tmpCanvas;\n  };\n\n  const generateDownload = (previewCanvas, crop) => {\n    if (!crop || !previewCanvas) {\n      return;\n    }\n\n    const canvas = getResizedCanvas(previewCanvas, crop.width, crop.height);\n    canvas.toBlob(\n      (blob) => {\n        const storageRef = firebase\n          .storage()\n          .ref()\n          .child(props.name + \".png\");\n        storageRef.put(blob).then((snapshot) => {\n          storageRef.getDownloadURL().then((url) => props.submit(url));\n        });\n      },\n      \"image/png\",\n      1\n    );\n  };\n\n  const onLoad = useCallback((img) => (imgRef.current = img), []);\n\n  return (\n    <div className={styles.wrapper}>\n      <div>\n        <input type=\"file\" accept=\"image/*\" onChange={onSelectFile} />\n      </div>\n      <ReactCrop\n        src={upImg}\n        onImageLoaded={onLoad}\n        crop={crop}\n        onChange={(c) => setCrop(c)}\n        onComplete={(c) => setCompletedCrop(c)}\n      />\n      {completedCrop?.width || completedCrop?.height ? (\n        <div\n          className={styles.preview}\n          style={{ width: completedCrop.width, height: completedCrop.height }}\n        >\n          <canvas\n            ref={previewCanvasRef}\n            style={{\n              width: completedCrop?.width ?? 0,\n              height: completedCrop?.height ?? 0,\n            }}\n          />\n        </div>\n      ) : null}\n      {completedCrop?.width || completedCrop?.height ? (\n        <button\n          type=\"button\"\n          onClick={() =>\n            generateDownload(previewCanvasRef.current, completedCrop)\n          }\n        >\n          Upload\n        </button>\n      ) : null}\n    </div>\n  );\n};\n\nexport default ImageCropper;\n","import React, { useEffect, useState } from \"react\";\nimport styles from \"../styles/profileMaker.module.css\";\nimport { Redirect } from \"react-router-dom\";\nimport Input from \"../components/Input\";\nimport ImageCropper from \"../components/ImageCropper\";\nimport { useParams, useHistory } from \"react-router-dom\";\nimport firebase from \"../helpers/firebase\";\nimport PrimaryButton from \"../components/PrimaryButton\";\n\nconst ProfileMaker = (props) => {\n  const [redirect, setRedirect] = useState(false);\n  const [name, setName] = useState(\"\");\n  const [toggle, setToggle] = useState(false);\n  const { title } = useParams();\n  const db = firebase.firestore();\n  const history = useHistory();\n\n  const submitHandler = (path) => {\n    if (!toggle) {\n      if (!name.length) {\n        alert(\"Enter the name\");\n        return;\n      }\n      setToggle(true);\n    } else {\n      const data = JSON.parse(sessionStorage.getItem(\"data\"));\n      console.log(path, data, title, name);\n      db.collection(\"safespace\")\n        .doc(data.name)\n        .update({\n          members: [\n            ...data.members,\n            {\n              role: title,\n              name: name,\n              url: path,\n            },\n          ],\n        })\n        .then(() => history.push(\"/safespace\"))\n        .catch((err) => alert(err.message));\n    }\n  };\n\n  useEffect(() => {\n    const token = sessionStorage.getItem(\"token\");\n    if (!token) {\n      setRedirect(true);\n    }\n  }, []);\n\n  return (\n    <div className={styles.wrapper}>\n      {redirect ? <Redirect to=\"/login\" /> : null}\n\n      <div className={styles.imageUploader}>\n        {toggle ? (\n          <ImageCropper submit={submitHandler} name={name} />\n        ) : (\n          <div className={styles.flex}>\n            <Input\n              title=\"enter the name\"\n              value={name}\n              onChangeText={(event) => setName(event.target.value)}\n            />\n            <PrimaryButton title=\"Next\" onClick={submitHandler} />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default ProfileMaker;\n"],"sourceRoot":""}