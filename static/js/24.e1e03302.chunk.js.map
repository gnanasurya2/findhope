{"version":3,"sources":["styles/ImageCropper.module.css","components/ImageCropper.js","containers/ProfileMaker.js"],"names":["module","exports","ImageCropper","props","useState","upImg","setUpImg","imgRef","useRef","previewCanvasRef","unit","width","aspect","crop","setCrop","completedCrop","setCompletedCrop","Firebase","setFirebase","useEffect","firebase","then","current","image","canvas","scaleX","naturalWidth","scaleY","naturalHeight","height","ctx","getContext","setTransform","imageSmoothingEnabled","drawImage","x","y","generateDownload","previewCanvas","newWidth","newHeight","tmpCanvas","document","createElement","getResizedCanvas","toBlob","blob","storageRef","storage","ref","child","name","put","snapshot","getDownloadURL","url","submit","onLoad","useCallback","img","className","styles","wrapper","type","accept","onChange","event","target","files","length","reader","FileReader","addEventListener","result","readAsDataURL","src","onImageLoaded","c","onComplete","preview","style","onClick","ProfileMaker","redirect","setRedirect","setName","toggle","setToggle","db","setDb","title","useParams","history","useHistory","firestore","submitHandler","path","data","JSON","parse","sessionStorage","getItem","collection","doc","toLowerCase","update","members","role","push","catch","err","alert","message","to","imageUploader","flex","Input","value","onChangeText","PrimaryButton"],"mappings":"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","file":"static/js/24.e1e03302.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"wrapper\":\"ImageCropper_wrapper__1nCsw\",\"preview\":\"ImageCropper_preview__2OrzB\"};","import React, { useState, useRef, useCallback, useEffect } from \"react\";\r\nimport ReactCrop from \"react-image-crop\";\r\nimport styles from \"../styles/ImageCropper.module.css\";\r\nimport \"react-image-crop/dist/ReactCrop.css\";\r\nimport firebase from \"../helpers/firebase\";\r\nimport Button from \"../components/PrimaryButton\";\r\n\r\nconst pixelRatio = 4;\r\nconst ImageCropper = (props) => {\r\n  const [upImg, setUpImg] = useState();\r\n  const imgRef = useRef(null);\r\n  const previewCanvasRef = useRef(null);\r\n  const [crop, setCrop] = useState({ unit: \"px\", width: 100, aspect: 1 });\r\n  const [completedCrop, setCompletedCrop] = useState(null);\r\n  const [Firebase, setFirebase] = useState(null);\r\n  useEffect(() => {\r\n    firebase.then((firebase) => setFirebase(firebase));\r\n  }, []);\r\n  useEffect(() => {\r\n    if (!completedCrop || !previewCanvasRef.current || !imgRef.current) {\r\n      return;\r\n    }\r\n\r\n    const image = imgRef.current;\r\n    const canvas = previewCanvasRef.current;\r\n    const crop = completedCrop;\r\n\r\n    const scaleX = image.naturalWidth / image.width;\r\n    const scaleY = image.naturalHeight / image.height;\r\n    const ctx = canvas.getContext(\"2d\");\r\n\r\n    canvas.width = crop.width * pixelRatio;\r\n    canvas.height = crop.height * pixelRatio;\r\n\r\n    ctx.setTransform(pixelRatio, 0, 0, pixelRatio, 0, 0);\r\n    ctx.imageSmoothingEnabled = false;\r\n\r\n    ctx.drawImage(\r\n      image,\r\n      crop.x * scaleX,\r\n      crop.y * scaleY,\r\n      crop.width * scaleX,\r\n      crop.height * scaleY,\r\n      0,\r\n      0,\r\n      crop.width,\r\n      crop.height\r\n    );\r\n  }, [completedCrop]);\r\n\r\n  const onSelectFile = (event) => {\r\n    if (event.target.files && event.target.files.length > 0) {\r\n      const reader = new FileReader();\r\n      reader.addEventListener(\"load\", () => setUpImg(reader.result));\r\n      reader.readAsDataURL(event.target.files[0]);\r\n    }\r\n  };\r\n  const getResizedCanvas = (canvas, newWidth, newHeight) => {\r\n    const tmpCanvas = document.createElement(\"canvas\");\r\n    tmpCanvas.width = newWidth;\r\n    tmpCanvas.height = newHeight;\r\n\r\n    const ctx = tmpCanvas.getContext(\"2d\");\r\n    ctx.drawImage(\r\n      canvas,\r\n      0,\r\n      0,\r\n      canvas.width,\r\n      canvas.height,\r\n      0,\r\n      0,\r\n      newWidth,\r\n      newHeight\r\n    );\r\n\r\n    return tmpCanvas;\r\n  };\r\n\r\n  const generateDownload = (previewCanvas, crop) => {\r\n    if (!crop || !previewCanvas) {\r\n      return;\r\n    }\r\n\r\n    const canvas = getResizedCanvas(previewCanvas, crop.width, crop.height);\r\n    canvas.toBlob(\r\n      (blob) => {\r\n        const storageRef = Firebase.storage()\r\n          .ref()\r\n          .child(props.name + \".png\");\r\n        storageRef.put(blob).then((snapshot) => {\r\n          storageRef.getDownloadURL().then((url) => props.submit(url));\r\n        });\r\n      },\r\n      \"image/png\",\r\n      1\r\n    );\r\n  };\r\n\r\n  const onLoad = useCallback((img) => (imgRef.current = img), []);\r\n\r\n  return (\r\n    <div className={styles.wrapper}>\r\n      <div>\r\n        <input type=\"file\" accept=\"image/*\" onChange={onSelectFile} />\r\n      </div>\r\n      <ReactCrop\r\n        src={upImg}\r\n        onImageLoaded={onLoad}\r\n        crop={crop}\r\n        onChange={(c) => setCrop(c)}\r\n        onComplete={(c) => setCompletedCrop(c)}\r\n      />\r\n      {completedCrop?.width || completedCrop?.height ? (\r\n        <div\r\n          className={styles.preview}\r\n          style={{ width: completedCrop.width, height: completedCrop.height }}\r\n        >\r\n          <canvas\r\n            ref={previewCanvasRef}\r\n            style={{\r\n              width: completedCrop?.width ?? 0,\r\n              height: completedCrop?.height ?? 0,\r\n            }}\r\n          />\r\n        </div>\r\n      ) : null}\r\n      {completedCrop?.width || completedCrop?.height ? (\r\n        <Button\r\n          type=\"button\"\r\n          onClick={() =>\r\n            generateDownload(previewCanvasRef.current, completedCrop)\r\n          }\r\n        >\r\n          Upload\r\n        </Button>\r\n      ) : null}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ImageCropper;\r\n","import React, { useEffect, useState } from \"react\";\r\nimport styles from \"../styles/profileMaker.module.css\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport Input from \"../components/Input\";\r\nimport ImageCropper from \"../components/ImageCropper\";\r\nimport { useParams, useHistory } from \"react-router-dom\";\r\nimport firebase from \"../helpers/firebase\";\r\nimport PrimaryButton from \"../components/PrimaryButton\";\r\n\r\nconst ProfileMaker = (props) => {\r\n  const [redirect, setRedirect] = useState(false);\r\n  const [name, setName] = useState(\"\");\r\n  const [toggle, setToggle] = useState(false);\r\n  const [db, setDb] = useState(null);\r\n  const { title } = useParams();\r\n  const history = useHistory();\r\n  useEffect(() => {\r\n    firebase.then((firebase) => setDb(firebase.firestore()));\r\n  }, []);\r\n  const submitHandler = (path) => {\r\n    if (!toggle) {\r\n      if (!name.length) {\r\n        alert(\"Enter the name\");\r\n        return;\r\n      }\r\n      setToggle(true);\r\n    } else {\r\n      const data = JSON.parse(sessionStorage.getItem(\"data\"));\r\n      // console.log(path, data, title, name);\r\n      db.collection(\"safespace\")\r\n        .doc(data.name.toLowerCase())\r\n        .update({\r\n          members: [\r\n            ...data.members,\r\n            {\r\n              role: title,\r\n              name: name,\r\n              url: path,\r\n            },\r\n          ],\r\n        })\r\n        .then(() => history.push(\"/safespace\"))\r\n        .catch((err) => alert(err.message));\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const token = sessionStorage.getItem(\"token\");\r\n    if (!token) {\r\n      setRedirect(true);\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <div className={styles.wrapper}>\r\n      {redirect ? <Redirect to=\"/login\" /> : null}\r\n\r\n      <div className={styles.imageUploader}>\r\n        {toggle ? (\r\n          <ImageCropper submit={submitHandler} name={name} />\r\n        ) : (\r\n          <div className={styles.flex}>\r\n            <Input\r\n              title=\"enter the name\"\r\n              value={name}\r\n              onChangeText={(event) => setName(event.target.value)}\r\n            />\r\n            <PrimaryButton title=\"Next\" onClick={submitHandler} />\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProfileMaker;\r\n"],"sourceRoot":""}